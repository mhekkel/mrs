<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE m6-config SYSTEM "http://mrs.cmbi.ru.nl/dtd/m6-config.dtd">
<m6-config>
	
<!--	<srvdir>/srv/mrs</srvdir>-->
	<srvdir>srv</srvdir>

	<server addr="0.0.0.0" port="18090">
		<docroot>./docroot/</docroot>
		<dbs>
			<db>omim</db>
			<db>pdbfinder</db>
			<db>sprot</db>
			<db>trembl</db>
		</dbs>
	</server>
	
	<parser id="pdbfinder">
		<match regex="^\s?(\w+)\s+:\s(.+)\n">
			<switch test="1">
				<case value="id">
					<capture nr="2">
						<index name="id" unique="true" type="string"/>
						<attr name="id"/>
					</capture>
				</case>
				<case value="header">
					<capture nr="2">
						<to-lower />
						<index name="header" type="text"/>
						<attr name="title"/>
					</capture>
				</case>
				<case value="author">
					<capture nr="2">
						<replace what="\." with=". "/>
						<index name="author" type="text"/>
					</capture>
				</case>
				<case value="chain">
					<stop/>
				</case>
				<default>
					<capture nr="2">
						<index name="text" type="text"/>
					</capture>
				</default>
			</switch>
		</match>
	</parser>

	<parser id="omim">
		<match regex="^\*FIELD\* (\w\w)\n((?(?=\*FIELD\*)(*ACCEPT)|.*\n)+)">
			<switch test="1">
				<case value="NO">
					<capture nr="2">
						<index name="id" unique="true" type="string"/>
						<attr name="id"/>
					</capture>
				</case>
				<case value="TI">
					<capture nr="2">
						<index name="title" type="text"/>
						<split separator=";;">
							<if iteration="1">
								<to-lower />
								<substr length="255" />
								<replace what="\s+" with=" " />
								<attr name="title"/>
							</if>
						</split>
					</capture>
				</case>
				<default>
					<capture nr="2">
						<index name="text" type="text"/>
					</capture>
				</default>
			</switch>
		</match>
	</parser>
	
	<parser id="uniprot">
		<match regex="^(?:([A-Z]{2})   ).+\n(?:\1.+\n)*">
			<switch test="1">
				<case value="ID">
					<replace what="^ID   (.+)\n" with="$1 "/>
					<match regex="^(\w+)" capture="1">
						<index name="id" unique="true" type="string"/>
						<attr name="id"/>
					</match>
				</case>
				<case value="AC">
					<replace what="^AC   (.+)\n" with="$1 "/>
					<split separator=";\s*">
						<index name="ac" unique="true" type="string"/>
					</split>
				</case>
				<case value="DE">
					<replace what="^DE   (.+)\n" with="$1 "/>
					<match regex="\w+: ((?:[^:;]+;\s*)+)" capture="1">
						<if iteration="1">
							<match regex="\w+=([^;]+);" capture="1">
								<attr name="title"/>
							</match>
						</if>
						<match regex="\w+=(.+)" capture="1">
							<index name="de"/>
						</match>
					</match>
				</case>
				<case value="GN">
					<replace what="^GN   (.+)\n" with="$1 "/>
					<split separator=";\s*">
						<match regex="(?:\w+=)?(.+)" capture="1">
							<index name="gn"/>
						</match>
					</split>
				</case>
				<case value="OS">
					<replace what="^OS   (.+)\n" with="$1 "/>
					<index name="os" type="string" />
				</case>
				<case value="OC">
					<replace what="^OC   (.+)\n" with="$1 "/>
					<split separator=";\s*">
						<index name="oc" type="string" />
					</split>
				</case>
				<case value="DR">
					<replace what="^DR   (.+)\n" with="$1 "/>
					<replace what="^(\w+); ([^;]+);.*" with="$1:$2" />
					<index name="dr" type="string" />
				</case>
				<case value="KW">
					<replace what="^KW   (.+)\n" with="$1 "/>
					<split separator=";\s*">
						<index name="kw" type="string"/>
					</split>
				</case>
				<case value="FT">
					<replace what="^FT.{32}(.+)" with="$1\n" />
					<index name="ft"/>
				</case>
				<case value="RX">
					<match regex="MEDLINE=([^;]+);" capture="1">
						<index name="medline"/>
					</match>
					<match regex="PubMed=([^;]+);" capture="1">
						<index name="pubmed"/>
					</match>
					<match regex="DOI=([^;]+);" capture="1">
						<index name="doi" type="string"/>
					</match>
				</case>
				<case value="SQ">
					<stop/>
				</case>
				<default>
					<replace what="^.{5}(.+)\n" with="$1\n"/>
					<index name="text"/>
				</default>
			</switch>
		</match>
	</parser>
	
	<databank id="pdbfinder" parser="pdbfinder">
		<name>PDBFINDER</name>
<!--		<file>C:\Users\maarten\projects\m6\test\pdbfinder.m6</file> -->
		<file>test/pdbfinder.m6</file>
		<locale>en_US.UTF-8</locale>
		
		<!-- source type can be path, glob or regex -->
<!--		<source type="path">test/PDBFIND2.TXT.gz</source>-->
<!--		<source type="path">C:\Users\maarten\projects\m6\test\PDBFIND2.TXT</source> -->
<!--		<source type="path">C:\Users\maarten\projects\m6\test\pdbfind2-head-2.txt</source>-->
		<source type="path">C:\Users\maarten\projects\m6\test\pdbfind2-head.txt</source>
		
		<!-- if no header-line or document-separator element is specified, the
			 entire file is considered to be one document. -->
		
		<!-- header-line's will be stripped off each file. If document-separator
			 below is specified as first-line-matches then this header is of course not needed. -->
		<header-line>^//.*</header-line>

		<!-- document-separator indicates either the start or the end of a document.
			 The content is interpreted based on the type attribute.
			 If type is last-line-equals (default) then a line equal to the content
			 indicates the end of a document.
			 The other types are last-line-matches (content is a regex), first-line-equal
			 and first-line-matches.
		-->
		<document-separator type="last-line-equals">//</document-separator>

	</databank>
	
	<!-- omim -->
	<databank id="omim" parser="omim">
		<name>OMIM</name>
		<file>test/omim.m6</file>
		<locale>en_US.UTF-8</locale>
		<source type="path">test/omim.dat.gz</source>
		<document-separator type="first-line-equals">*RECORD*</document-separator>
	</databank>
	
	<databank id="sprot" parser="uniprot">
		<name>SwissProt</name>
		<file>/data/md1120/tmp/sprot.m6</file>
		<source type="path">/data/raw/uniprot/uniprot_sprot.dat.gz</source>
		<document-separator type="last-line-equals">//</document-separator>
	</databank>

	<databank id="sprotw" parser="uniprot">
		<name>SwissProt</name>
		<file>test/sprot.m6</file>
		<source type="path">test/sprot-mini.dat</source>
		<document-separator type="last-line-equals">//</document-separator>
	</databank>
	
	<databank id="trembl" parser="uniprot">
		<name>TrEMBL</name>
		<file>/data/md1120/tmp/trembl.m6</file>
		<source type="path">/data/raw/uniprot/uniprot_trembl.dat.gz</source>
		<document-separator type="last-line-equals">//</document-separator>
	</databank>
	
<!--
	<databank id="genbank">
		<name>Genbank</name>
		<file>test/genbank.m6</file>
		<locale>en_US.UTF-8</locale>
		
		<source type="path">/data/raw/genbank_release/*.seq.gz</source>
		
		<document-separator type="first-line-matches">^LOCUS </document-separator>
		<document-separator type="last-line-equals">//</document-separator>

		<match regex="^\s*(\w+)\s+((?:.+)(?:\n\s{5,}.+)*)">
			<switch>
				<case test="$1 eq 'locus'">
					<substring location="13-28">
						<store action="index attr unique" name="id"/>
					</substring>
					<substring location="69-79">
						<store action="index" name="date" type="date" format="dd-MMM-yyyy" />
					</substring>
				</case>
				
				<case test="$1 eq 'definition'">
					<store name="title" action="index attr" />
				</case>

				<case test="$1 eq 'accession'">
					<match split="\s+">
						<store name="accession" action="index unique" />
					</match>
				</case>
				
				<case test="$1 eq 'version'">
					<match regex="(\S+) GI:(\d+)">
						<capture nr="1">
							<store name="version" action="index unique"/>
						</capture>
						<capture nr="2">
							<store name="gi" action="index unique" />
						</capture>
					</match>
				</case>
				
				<case test="$1 eq 'features'">
					<match regex="^\s{5}(\w+)\s+((?:\S.+)(?:\n\s{20,}.+)*)">
						<match regex="/(\w+)="((?:\n|[^"]|"")*?)">
							<store name="feature" action="index"/>
						</match>
					</match>
				</case>
				
				<case test="$1 eq 'origin'">
					<stop />
				</case>
				
				<default>
				</default>
			</switch>
		</match>
	</databank>
	-->
	
</m6-config>
